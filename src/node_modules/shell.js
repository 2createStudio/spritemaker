'use strict';

/**
 * Dependencies
 */
var fs       = require('fs');
var ch       = require('child_process');
var path     = require('path');
var mustache = require('mustache');

/**
 * Contains all methods used for sprite generation.
 * @type {object}
 */
var shell = {};

/**
 * Generates a new Gruntfile.js from template.
 * @param  {object} data 
 * @return {void}      
 */
shell.prepareGruntfile = function(data) {

	var cwd  = process.cwd();
	var file = cwd + '\\Gruntfile.js';
	var tpl  = cwd + '\\Gruntfile.js.mustache';

	// read & render template
	tpl = fs.readFileSync(tpl, { encoding: 'utf8' });
	tpl = mustache.render(tpl, data);

	// save new settins to Gruntfile.js
	fs.writeFileSync(file, tpl, { encoding: 'utf8' });

}

/**
 * Runs a grunt task via node.
 * @param  {function} fn
 * @return {void}      
 */
shell.runTask = function(fn) {
	ch.exec('node -e "require(\'grunt\').tasks([\'sprite\'])"', fn || function() {});
}

/**
 * Publish module API.
 */
exports.shell = shell;